---
# ==============================================================================
# Scheduler Test DAG
# ==============================================================================
#
# Purpose: Verify that the scheduler is working and GitHub Actions sync works
# Created: To test v1.1.3 scheduler fix and incremental sync
# ==============================================================================

name: scheduler-test
description: "Simple test to verify scheduler and sync functionality"

env:
  - TEST_TIME: "{{ now }}"

steps:
  - name: timestamp
    description: "Show current timestamp"
    command: |
      echo "╔════════════════════════════════════════╗"
      echo "║      Scheduler Test Started            ║"
      echo "╚════════════════════════════════════════╝"
      echo ""
      echo "Current time: $(date)"
      echo "Hostname: $(hostname)"
      echo "Test completed successfully"
      echo ""

  - name: system-info
    description: "Display system information"
    command: |
      echo "=== System Information ==="
      echo "Uptime: $(uptime -p)"
      echo "Load average: $(cat /proc/loadavg | cut -d' ' -f1-3)"
      echo "Memory: $(free -h | grep Mem | awk '{print $3 "/" $2}')"
      echo ""
    depends:
      - timestamp

  - name: dagu-info
    description: "Display Dagu service information"
    command: |
      echo "=== Dagu Service Status ==="
      systemctl is-active dagu && echo "✓ Dagu service is running" || echo "✗ Dagu service is not running"
      echo ""
      echo "Config location: /etc/dagu/config.yaml"
      echo "DAGs directory: /opt/dagu/dags"
      echo ""
      echo "DAG count: $(ls -1 /opt/dagu/dags/*.yaml 2>/dev/null | wc -l)"
      echo ""
    depends:
      - system-info

  - name: summary
    description: "Test summary"
    command: |
      echo "╔════════════════════════════════════════╗"
      echo "║   Scheduler Test Completed             ║"
      echo "╚════════════════════════════════════════╝"
      echo ""
      echo "This test verifies:"
      echo "  ✓ Scheduler is running (if this executed on schedule)"
      echo "  ✓ GitHub Actions sync works (if you see this DAG)"
      echo "  ✓ DAG execution works properly"
      echo ""
      echo "Completed: $(date)"
    depends:
      - dagu-info

tags:
  - test
  - scheduler
  - monitoring
